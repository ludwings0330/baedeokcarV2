<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="~{fragments/header::fragment-header}"></div>
</head>
<body>
<div th:replace="~{fragments/nav::fragment-nav}"></div>
<div class="content">
    <div class="container mt-3">
        <h1>회원가입</h1>
        <hr/>

        <form action="/member" id="frm" method="post">
            <div class="mb-3">
                <label for="loginId" class="form-label">ID</label>
                <input type="text" class="form-control" id="loginId" name="loginId" placeholder="사용할 아이디를 입력하세요."/>
                <div id="id-success" class="mt-3 alert alert-success">사용 가능한 아이디입니다.</div>
                <div id="id-error" class="mt-3 alert alert-danger">중복된 아이디 입니다.</div>
            </div>

            <div class="mb-3">
                <label for="name" class="form-label">Name</label>
                <input type="text" class="form-control" id="name" name="name" placeholder="이름을 입력하세요."/>
            </div>

            <div class="mb-3">
                <label for="loginId" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" name="password" placeholder="비밀번호를 입력하세요."/>
            </div>

            <div class="mb-3">
                <label for="loginId" class="form-label">Check Password</label>
                <input type="password" class="form-control" id="password-check" name="password-check" placeholder="비밀번호를 한번 더 입력하세요."/>
                <div id="pwd-success" class="mt-3 alert alert-success">비밀번호가 일치합니다.</div>
                <div id="pwd-error" class="mt-3 alert alert-danger">비밀번호가 일치하지 않습니다.</div>
            </div>

            <div class="mx-auto">
                <button id="submit" class="btn btn-primary">가입</button>
            </div>
        </form>
    </div>
</div>
<footer th:replace="~{fragments/footer::fragment-footer}"></footer>
<script type="text/javascript">
    let pwdCheck = false;
    let idCheck = true;

    $(document).ready(function () {
        $(".alert").hide();
        $("#submit").attr("disabled","disabled");

        $("#password-check").keyup(function () {
            let pwd1 = $("#password").val();
            let pwd2 = $("#password-check").val();

            if (pwd1 != "") {
                if (pwd1 === pwd2) {
                    pwdCheck = true;
                    $("#pwd-error").hide();
                    $("#pwd-success").show();
                    if (pwdCheck && idCheck) {
                        $("#submit").removeAttr("disabled");
                    }
                } else {
                    pwdCheck = false;
                    $("#pwd-success").hide();
                    $("#pwd-error").show();
                    $("#submit").attr("disabled", "disabled");
                }
            }
        });

        $("#submit").click(function () {
            if (confirm("회원가입을 하시겠습니까?")) {
                $("#frm").submit();
            } else {
                return false;
            }
        });

        $("#loginId").blur(function () {
            let loginId = $("#loginId").val()
            console.log(loginId);
            $.ajax({
                async: true,
                type: 'POST',
                data: {"loginId":loginId},
                url: "/idCheck.do",
                dataType: "json",

                success: function (data) {

                    if (data.canUse === "true") {

                        idCheck = true;
                        $("#id-error").hide();
                        $("#id-success").show();

                        if (pwdCheck && idCheck) {
                            $("#submit").removeAttr("disabled");
                        }

                    } else {
                        idCheck = false;
                        $("#id-success").hide();
                        $("#id-error").show();
                        $("#submit").attr("disabled", "disabled");
                    }
                },

                error: function (error) {
                    alert("error : " + error);
                }
            });
        });
    });
</script>

</body>
</html>
